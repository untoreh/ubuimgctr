services:
- docker
script:
- export SAVE=$PWD cnt="ubuimgctr" slim=".slim"
- docker pull willnorris/imageproxy
- docker tag willnorris/imageproxy ${cnt} 
- >
  sudo ./docker-slim build 
  --continue-after 10
  --http-probe 
  ${cnt} 
  
before_deploy:
- cd
- wget `curl -s https://api.github.com/repos/appc/docker2aci/releases | grep browser_download_url | head -n 1 | cut -d '"' -f 4` -O d2a.tar.gz
- tar -zxf d2a.tar.gz && rm d2a.tar.gz && d2a=`ls | grep "docker2aci*"` && d2a=`basename  $d2a` && alias d2a='${PWD}/${d2a}/docker2aci'
- docker save -o ${cnt}.slim.tar ${cnt}.slim
- "${PWD}/${d2a}/docker2aci ${cnt}.slim.tar"
- xz -9 -c ${cnt}.slim.tar > ${cnt}.slim.tar.xz
- docker login -e $QUAYE -u $QUAYL -p $QUAYP  quay.io
- docker tag ${cnt}${slim} quay.io/natostanco/$cnt:$TRAVIS_TAG
- docker push quay.io/natostanco/$cnt:$TRAVIS_TAG
deploy:
  provider: releases
  api_key:
    secure: A5WuZVgwYIFsf6X+0W5Z2NvS1sAkYs76dXFJzNvJB1Ju1m5CKR+S39hZMJlifVA+MXdIDwyLE8RWWl/zW9hotBf/cWyNZjivEuU+sKOCATrKT4giRXfjA4QAgmp8TBby9uyDoV/EXhOgBITxNBRQwfEsA2amBi+M8ebJhplCNfWzXfhj/uusV8pr7L5pWVnH8arLHpK+QsU3IN3ELnAVQj8k9JxS33bLi3sF6qVXOIFrOdHKNJgNJL7Mx9WcD1CUq0IjPzguJkQPIypVoKlfcku6kMsOYizaE8xwu7RWQoWX2Uk43RTRFBjIK3NhvGyrrSCm4OEJ0xcZAVUsgaMr/3EPosG2YMWyii0H5sNVHYri5ZBl8ewzUF/mLwCMUbEscaizJCIGNtivXTukG9jbYZTwcX8oFrX+BSMjNAAWU7+AN2aF9n8BigrLwYLg6SzpDQzruFysJ74eXUCFjm5e1D6Lu5V/vkWYl1VxULClZ4Xx1o7TdlZPZn81mZ1TEOMweNwL1yf/t8GoMFeSs7RTupqduS2ccLxPUR4aVr2c5NPwS57Pf6gbWzfe7C4BRbfJ1NOJRLepAEa7VQ1nCzAfwsWIb0zmGsiNqmvwmyFNM9SwkKXlIR+Cu0Pz8yE9LzG+7pmnBbc4ZluDUJB/HSZOrvBpVOmCKU9cWURb0d/nM7M=
  file:
  - "${cnt}.slim.tar.xz"
  - "${cnt}.slim-latest.aci"
  skip_cleanup: true
  on:
    tags: true
